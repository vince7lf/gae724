\label{preparation_nano_ordinateur}
\par L'organigramme de la figure \ref{fig:preparation_nano_ordinateur} présente les activités qui composent la préparation du nano ordinateur. 
\begin{figure}[H]
    \centering
    \includegraphics[width=1.0\textwidth]{preparation_nano_ordinateur}
    \caption{Préparation du nano ordinateur}
    \label{fig:preparation_nano_ordinateur}
\end{figure}
\myparagraph{Montage}
\par Le nano ordinateur est une carte mère livrée sans aucun périphérique ni même boitier. Vu que les performances logicielles dépendent des performances matérielles, surtout pour une unité telle qu'un nano ordinateur où les capacités matérielles sont très limitées, la première partie de l'essai a été allouée à la sélection des accessoires et périphériques qui vont permettre d'augmenter les performances, protéger et utiliser confortablement le nano ordinateur. 
\label{montage_nano_ordinateur}
\par L'organigramme de la figure \ref{fig:montage_nano_ordinateur} présente les activités qui composent le montage du nano ordinateur. 
\begin{figure}[H]
    \centering
    \includegraphics[width=1.0\textwidth]{montage_nano_ordinateur}
    \caption{Montage du nano ordinateur}
    \label{fig:montage_nano_ordinateur}
\end{figure}
\mysubparagraph{Préparation de la carte mère Jetson Nano}
% \begin{wrapfigure}{R}{0.25\textwidth}
%     \includegraphics[width=0.25\textwidth]{metho_recherche}
% \end{wrapfigure}
% \begin{wrapfigure}{R}{0.25\textwidth}
\begin{figure}[H]
\centering
    \includegraphics[width=0.4\textwidth]{jetson_nano}
    \caption{Carte mère du nano ordinateur}
    \label{fig:jetson_nano}
\end{figure}
% \end{wrapfigure}
\par Le nano ordinateur qui est livré dans sa boite est uniquement une carte mère, sans unité de stockage, ni boitier, clavier, souris, écran, capacité wifi, ou caméra. Il est uniquement livré avec un câble micro USB qui lui permet d'être démarré avec une alimitation minimale de 5 Volts/2Amp et ne consommer que 5 Watts. Aucun système d'exploitation n'est livré non plus. Vu que de l'objectif de l'essai est de tester les capacités du nano ordinateur et que la consommation sera de plus de 5Watt due aux branchements de multiples périphériques, certaines "broches" sur la carte mère doivent être activées:  la broche J48 permet de brancher un adaptateur d'alimentation de 5Volts 4Amp au lieu de l'alimentation micro USB; et la broche J38 permet d'activer le PoE (Power-Over-Ethernet) afin d'hériter de l'alimentation du câble Ethernet. Aucune autre préparation sur la carte n'est nécessaire.

\mysubparagraph{Alimentation}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.5\textwidth]{alimentation}
    \caption{Adaptateur 5 volts 4 amps}
    \label{fig:alimenation}
\end{figure}
\par L'alimentation du nano ordinateur est l'élément matériel le plus important du système. De base le nano ordinateur est livré avec un câble micro USB, lui permettant d'être alimenté en 5Volt 2Amp. Mais le besoin en énergie augmente avec les périphériques qui s'accumulent, tel qu'une caméra. Il est prudent de choisir un adaptateur 5Volt 4Amp d'un fournisseur recommandé par NVIDIA, car un changement de puissance sensible en entrée impacte le fonctionnement opérationnel du nano ordinateur. Deux adaptateurs ont été utilisés, l'un recommandé, et l'autre non, afin de tester leur performance. 
\par Dans le cadre de l'essai, l'alimentation du nano ordinateur est utilisée pour alimenter la carte mère, qui comporte entre autres les CPUs, le GPU, le Hub USB 3.0 interne, le contrôleur Ethernet et le port HDMI. Mais aussi la caméra et  le ventilateur et optionnellement une carte d'extension M.2 NVMe. Afin d'assister l'adaptateur, un hub USB 3.0 externe a été utilisé pour brancher la souris, le clavier, et à un moment donné le dongle Wifi.
\mysubparagraph{Boitier}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.35\textwidth]{boitier}
    \caption{Boitier pour le nano ordinateur}
    \label{fig:boitier}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.5\textwidth]{boitier_back}
    \caption{Vue arrière du boitier pour le nano ordinateur}
    \label{fig:boitier_arriere}
\end{figure}
\par Afin de protéger le nano ordinateur durant l'essai et l'utiliser dans les conditions les plus proches de son futur mode d'opération, il a été installé dans un boitier en métal. Le boitier a été choisi en tenant compte qu'une carte d'extension pour un SSD interne sera installée, ainsi qu'une caméra et un ventilateur. Durant l'essai le nano ordinateur sera manipulé très fréquemment en raison d'un manque d'espace réservé dans la maison. Le boitier permet donc d'éviter de manipuler le matériel et les connecteurs, les protège, évitant de risquer de les briser, et donc ajouter des délais à l'essai. 
\mysubparagraph{Unité de stockage}
\par Le nano ordinateur est conçu pour fonctionner avec un système d'exploitation hébergé sur une carte microSD. Il existe différentes cartes microSD, et certaines sont  beaucoup plus performantes que les autres. Malheureusement les cartes microSD ne sont pas destinées à exécuter un système d'exploitation à temps plein, et leur espérance de vie reste très limitée.  Étant donné que l'objectif du nano ordinateur est d'être en service continu à l'extérieure, l'utilisation un disque SSD interne comme alternative semble logique.
\par\underline{Carte microSD}
\par Il existe différentes cartes microSD, de multiples constructeurs, et pour différents usages, mais généralement destiné pour stocker des images et vidéos directement par les appareils multimédias. Leur conception est faite pour la manipulation de gros blocs de données, et non des petits fichiers. Trois cartes microSD 
seront évaluées:
{
    \renewcommand*{\arraystretch}{1.4}
    \begin{table}[ht]
    \centering
    \caption{Cartes microSD}\label{table:cartes_microSD}
    \vspace{0.1em} % Adjust the height of the space between caption and tabular
    \begin{tabular}{l}
        \includegraphics[width=0.10\textwidth]{micro_sd_evo_plus} microSD Samsung EVO 64Gb Plus XC I Grade 3 Class 10\\
        \includegraphics[width=0.10\textwidth]{micro_sd_evo} microSD Samsung EVO 64Gb Select XC I Grade 3 Class 10\\
        \includegraphics[width=0.10\textwidth]{Microsd card Scan Disk Ultra 32Gb class 10 HC I} microSD Scan Disk Ultra 32Gb HC I Class 10\\
    \end{tabular}
    \end{table}
}
{\color{red}\todo{fix le tableau}}
\par\underline{Disque SSD}
% \mysubparagraph{SSD interne Nvme M.2 avec carte d'extension M.2 vers USB3.0}
% \par Pour un appareil destiné à être continuellement en service et à l'extérieure, l'unité de stockage doit être non seulement performante, mais aussi endurante. Un disque SSD interne pour un nano ordinateur est soit une carte d'extension M.2 NVMe ou SATA (selon la carte d'extension), connecté au port PCIe ou USB. Les SSD internes Samsung 970 EVO 250GB NVMe M.2 et Samsung 860 EVO M.2 500GB SATA seront évalués. À noter qu'une carte microSD est tout de même nécessaire pour "bootstrapper" le système d'exploitation. Il n'est pas nécessaire d'avoir une carte microSD performante puisqu'elle n'est utilisée que pour démarrer le système qui se trouve sur le SSD interne. 
\par Un disque SSD et une carte microSD sont différents type de matériel pour différents usages. Le disque SSD est plus adapté pour manipuler les petits fichiers et héberger un système d'exploitation. Il est aussi plus résilient à long terme. C'est donc une option qui ne doit pas être négligée dans le contexte de tests de performance, encore plus avec un nano ordinateur dont les capacités matérielles sont limitées, et qui est un appareil destiné à être continuellement en service et à l'extérieure. L'unité de stockage doit être non seulement performante, mais aussi endurante. Néanmoins, il y a un contreparti important dans la situation d'un nano ordinateur: la consommation d'énergie. Un SSD interne va demander plus d'énergie qu'une carte microSD, et si le nano ordinateur n'est pas capable de gérer correctement les besoins en énergie de ses extensions matériels, le SSD interne risque d'échouer en pleine opération et le nano ordinateur devenir non fonctionnel soudainement.
\par Un disque SSD interne pour un nano ordinateur est soit une carte d'extension M.2 NVMe ou SATA (selon la carte d'extension), connecté au port PCIe ou USB. Les SSD internes Samsung 970 EVO 250GB NVMe M.2 et Samsung 860 EVO M.2 500GB SATA seront évalués.
\begin{figure}[H]
    \centering
    \includegraphics[width=0.5\textwidth]{Samsung 970 EVO Plus 250GB M.2 NVMe Internal Solid State Drive}
    \caption{Disque SSD NVMe M.2 interne 250GB}
    \label{fig:disquessd}
\end{figure}
\par Il y a deux choix qui ont été retenus pendant l'essai pour brancher un SSD interne au nano ordinateur: soit via une carte d'extension M.2 MVMe, et connecté via le Hub USB, soir via une carte d'extension M.2 NVMe connectée au port PCIe interne du nano ordinateur, normalement destiné à une carte d'extension Wifi.
\par Concernant le disque SSD M.2 NVMe connecté à la carte d'extension M.2 via le Hub USB 3.0 interne, le système L4T de NVIDIA ne supporte pas les SSD M.2 NVMe connecté au port USB \footnote{À noter que la carte d'extension T100 est discontinuée et remplacée par la T130}. Il n'est pas reconnu / détecté, il est donc impossible de le formater, de le partitionner, de l'utiliser. Comme il serait risqué pour l'essai de se lancer dans la recompilation du kernel du L4T, une alternative trouvée sur le développeur forum de NVIDIA est de passer par un adaptateur M.2 MVMe connecté au port PCIe interne.
\par Malheureusement cette alternative a rapidement été abandonnée. Il a été possible de démarrer et installer le système d'opération sur le SSD M.2, et faire quelques tests, mais pour une raison inconnue, le système n'était pas stable et devenait non opérationnel assez rapidement, le système perdant la connexion au SSD. La durée la plus longue de stabilité observée a été de moins 30 minutes. Une hypothèse est une baisse d'énergie qui survient à un moment et qui impacte l'alimentation du SSD, chaque volt et milliampère étant important pour la stabilité du nano ordinateur. De plus, le raccordement du câble de la carte d'extension M.2 NVMe PCIe avec le SSD M.2 NVMe est très compliqué et risqué pour le câble lui-même. Une autre limitation importante est que cette solution ne permet pas d'utiliser le boitier, car le SSD M.2 ne rentre pas et ne peut même pas être fixé. 
\par Différentes options pour optimiser l'alimentation ont été explorées: utiliser un HUB USB externe et auto alimenté; brancher un câble Ethernet au lieu d'utiliser un Dongle Wifi; allumer le ventilateur dès le démarrage du nano ordinateur; et l'option de fournir 6Amp directement supportée par la carte mère via les pins; explorer les solutions sur les forums de discussion \footnote{\url{https://www.kingston.com/en/community/articledetail/articleid/48543}} \footnote{\url{https://geekworm.com/products/nvidia-jetson-nano-nvme-m-2-ssd-shield-t100-v1-1}}.
\mysubparagraph{Caméra}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.25\textwidth]{camera}
    \caption{Caméra}
    \label{fig:camera}
\end{figure}
\par L'objectif du nano ordinateur est d'être utilisé pour détecter continuellement les délimitations de la piste cyclable. Il est évident qu'une caméra doit donc faire partie du système et faire partie de l'évaluation des performances. Néanmoins, durant le déroulement de l'essai, la caméra sera très peu utilisée. En effet il n'est pas évident d'être dans un mode de développement directement sur le terrain. Un matériel vidéo virtuel sera utilisé pour simuler la caméra et alimenter l'inférence avec des vidéos préenregistrées, permettant ainsi d'évaluer les performances de l'inférence avec des vidéos, même si d'un point de vue performance matérielle l'utilisation ne sera pas équivalente. Les performances matérielles de l'inférence en temps réel seront évaluées avec la caméra, même si la vue de la caméra n'est pas la piste cyclable, ce qui n'est pas important pour ce test, peu importe ce qui est détecté. 
\par la caméra qui a été sélectionnée est la version 2 de celle du fournisseur Raspberry Pi, le concurrent direct du nano ordinateur NVIDIA Jetson Nano. Cette caméra a été éprouvée avec le temps, est performante, elle semble être la plus adaptée pour ce genre de projet. 
\mysubparagraph{Ventilateur}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.25\textwidth]{fan}
    \caption{Ventilateur}
    \label{fig:fan}
\end{figure}
\par Un système informatique a besoin d'un ventilateur pour évacuer la chaleur produite par ses processeurs et les autres éléments électroniques, et éviter une faute opérationnelle et des bris de matériel. L'objectif du nano ordinateur étant d'être opérationnel continuellement, et ses éléments étant contenus dans un boitier, il est encore plus indispensable d'installer un ventilateur. Le ventilateur choisi a pu être installé dans le boitier, même si le boitier ne possède de support pour le fixer. Le ventilateur est capable de démarrer automatiquement au besoin, mais il est volontairement démarré manuellement dès que le nano ordinateur est démarré. Cela évite que la chaleur ne s'accumule, qu'elle soit tout de suite ventilée à l'extérieure, évitant un risque de surchauffe, la capacité du ventilateur étant tout de même limité (petit modèle).
\mysubparagraph{Hub USB externe 3.0 4 ports}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.3\textwidth]{Powered USB Hub 3.0, Atolla 7-Port USB Data Hub Splitter with One Smart Charging}
    \caption{Hub USB 3.0 externe autoalimenté}
    \label{fig:hubusb}
\end{figure}
\par Le nano ordinateur comprend un hub USB 3.0 4 ports internes, les 4 ports étant connectées via le même contrôleur. Ce hub consomme de l'énergie pour alimenter les périphériques qui y sont connectés, comme un SSD interne ou un dongle Wifi, et gérer l’ échange de données. Afin de minimiser les besoins en alimentation et optimiser le plus possible le transfert de données, la souris, le clavier et le dongle USB ont été branchés a un hub USB 3.0 externe autoalimenté. Malheureusement cette option complexifie le déploiement sur le terrain du nano ordinateur. L'alternative pour s'en passer est d'utiliser un câble Ethernet, PoE préférablement, à la place d'un dongle Wifi qui est très gourmant en termes de besoin en alimentation, et chauffe rapidement.
\mysubparagraph{Réseau Internet}
\par Le nano ordinateur comprend un contrôleur Ethernet pour brancher un câble réseau et se brancher sur Internet. Selon la configuration de la carte mère, le nano ordinateur peut hériter de l'alimentation via Ethernet (PoE), via la broche J38. Il comprend aussi un port PCIe interne qui permet de brancher une carte d'extension Wifi. L'autre alternative étant de passer par un dongle USB Wifi, ou un périphérique Wifi externe connecté au port USB. 
\par Dans le cadre de cet essai, le périphérique Wifi externe USB a été utilisé en premier puisque déjà disponible. Malheureusement les performances étaient assez décevantes, le réseau Wifi à la maison n'étant pas non plus très performant dans la pièce ou le nano ordinateur était installé (table de la cuisine). Un débit d'environs 5Mbits était disponible. Par curiosité un dongle USB Wifi a été acquis, mais autant décevant. La meilleure alternative pour améliorer le déroulement de l'essai a été de tirer un câble Ethernet et d'installer un router secondaire, et de brancher le nano ordinateur a ce nouveau router. L'accès Internet a été plus stable et de bien meilleure qualité, la connexion étant d'environs 11Mbs. 
\par Le PoE n'a pas été évalué. 
\myparagraph{Préparation de l'unité de stockage}
Le nano ordinateur est conçu pour fonctionner avec une microSD, et NVIDIA fournit uniquement de la documentation à cet effet. L'option d'utiliser un disque SSD interne est disponible sur Internet, mais n'est pas supporté officiellement par NVIDIA. Il existe néanmoins des articles à ce sujet dans le forum des développeurs\footnote{\url{https://forums.developer.nvidia.com/t/how-to-connect-ssd-to-jetson-nano/74053}}. 
\mysubparagraph{Carte microSD}
\par NVIDIA fournit de la documentation très claire et simple afin de préparer la carte microSD (formattage) et installer l'image du JetPack.\footnote{\url{https://developer.nvidia.com/embedded/learn/get-started-jetson-nano-devkit#write}}.
\mysubparagraph{Disque SSD}
\par La procédure d'installation pour installer JetPack sur le SSD interne est disponible sur le site "jetsonhacks.com"\footnote{\url{https://www.jetsonhacks.com/2019/09/17/jetson-nano-run-from-usb-drive/}}. À noter qu'une carte microSD est tout de même nécessaire pour "bootstrapper" le système d'exploitation. Il n'est pas nécessaire d'avoir une carte microSD performante puisqu'elle n'est utilisée que pour démarrer le système qui se trouve sur le SSD interne. 
\myparagraph{Configuration du système d'exploitation}
\par La première fois que le système démarre, le système Ubuntu Linux For Tegra (L4T) doit être configuré avec toutes les options personnalisées (langue, clavier, timezone, etc.).
\myparagraph{Installation \& compilation des librairies pour l'inférence}
\par Les librairies pour la segmentation sémantique 
d'images et de vidéos via l'inférence de modèles déjà préparée sont mises à disposition par NVIDIA via un projet dans GitHub. La documentation pour l'installation et l'inférence est disponible directement dans la page GitHub. 
\myparagraph{Installation d'un matériel vidéo virtuel 'v4l2loopback'}
\par L'inférence fournie par NVIDIA est conçue pour utiliser la caméra du nano ordinateur. Ce qui n'est pas forcément "pratique" pour évaluer la segmentation sémantique d'une vidéo d'une piste cyclable. Heureusement un matériel vidéo virtuel permet de simuler la caméra et d'alimenter l'inférence avec une vidéo enregistrée, au lieu de la caméra. La contrepartie concerne l'évaluation des performances:  en effet la caméra demande plus de puissance au nano ordinateur que le simulateur logiciel.
\myparagraph{Tests}
\par Afin de s'assurer que le nano ordinateur est prêt pour être évalué, des tests matériels et logiciels sont  effectués une fois le système monté et stabilisé. Les résultats des tests servent de référence pour évaluer l'état de santé du nano ordinateur. 